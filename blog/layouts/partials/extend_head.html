<!-- layouts/partials/extend_head.html -->
<!-- Cookie Consent -->
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script>
window.addEventListener('load', function(){
    window.cookieconsent.initialise({
        "palette": {
            "popup": {
                "background": "#2b2b2b",
                "text": "#ffffff"
            },
            "button": {
                "background": "#0051c3",
                "text": "#ffffff"
            }
        },
        "theme": "classic",
        "type": "opt-in",
        "content": {
            "message": "This website uses analytics cookies to help us understand how you use the site.",
            "dismiss": "Decline",
            "allow": "Accept",
            "link": "Learn more",
            "href": "/privacy-policy"
        }
    });
});
</script>

<!-- Google Analytics - Only loads after consent -->
{{ with site.Params.googleAnalytics }}
<script>
    // Function to load analytics
    function loadAnalytics() {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ . }}', { 'anonymize_ip': true });
    }

    // Check for cookie consent status
    window.addEventListener('load', function() {
        var cookieStatus = document.cookie.match('(^|;)\\s*cookieconsent_status\\s*=\\s*([^;]+)');
        if (cookieStatus && cookieStatus[2] === 'allow') {
            loadAnalytics();
        }
    });
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
{{ end }}